# OAuth/OIDC demo on **`Spotify`**

In this setup, we'll be performing below actions to authenticate and authorize users using Spotify AuthZ server and access various Web APIs/resources available on [Spotify Developer Portal](https://developer.spotify.com/) to create playlist,add tracks to playlist, search songs etc. 

## Create and Register New App on Spotify
1. Login to [Spotify Developer Portal](https://developer.spotify.com/).
2. Click on the dropdown from profile at top right hand corner. Click **`Dashboard`**.
3. Click **`Create app`** and fill in below required details to the form. Consider this as an app which will be utilized by users registered with Spotify to access various [Web API](https://developer.spotify.com/documentation/web-api) and manipulate content and configurations.
   * set an appropriate **`App name`**
   * set the **`Redirect URI`** as any random host and port since we don't have a landing page yet for our app where users will be redirected after AuthN and AuthZ. 
   
   ![ScreenShot](/images/spotify-create-app.PNG?raw=true) 
   
4. Once created, click the newly created app which will redirect to **`Home`** where various telemetry for the app can be monitored.
5. Click **`Settings`** to review the **`Client ID`** and **`Client Secret`** for the app.
6. Additional users(must have Spotify account) can be registered to the app from **`User Management`** tab on **`Home`**.

## Request User Authorization
We'll be authorizing the user using **`Authorization Code Flow`**.The authorization code flow is suitable for long-running applications (e.g. web and mobile apps) where the user grants permission only once.
1. Prepare the below URI and parameters and paste it on a browser.The first step is to request authorization from the user so that our app can access to the Spotify resources on the user's behalf. To do this, our application must build and send a GET request to the /authorize endpoint.
   
        https://accounts.spotify.com/authorize?client_id=<Client_Id as generated above>&response_type=code&redirect_uri=http://localhost:8080/*&scope=user-read-private user-read-email playlist-modify-private playlist-read-private ugc-image-upload
        
     * set the Client ID as generated while creating the app.
     * response_type=code represents **`Authorization Code Flow`**.
     * Scopes provide Spotify users using third-party apps the confidence that only the information they choose to share will be shared, and nothing more.
     
2. On submitting the above URI, user will be prompted with Spotify Login page.      
   
   ![ScreenShot](/images/spotify-login.PNG?raw=true)   
   
3. Once logged in, user will be redirected to an portal where all the scopes defined during initial request from above is list out for user confirmation. Please review and click **`Agree`**.   
   
   ![ScreenShot](/images/spotify-authorize.PNG?raw=true)  
   
4. On executing above step, the page will fail as the redirect URI configured in above steps is not valid. Copy the URI from the browser address bar as it contains the Authorization Code generated by Spotify AuthZ server. This code will be used to generate the access token. Sample provided below - 
      
      
      http://localhost:8080/*?code=AQCPK0cOk3BKNFd56aSWFKCnSOTp9Vbfg3kQvIA4QgxB9hDT9xLt21ev4RqrMwXBb2MwsXEfvy1R-9RcJXMH8n3x-CkKuO-Qs2QVc5clRVsgYjwWjKV5mqUETZLWWxj059dBqmAPKHwXDaukKfbquRxAorHhiDPHuG1mDk0jMOdreO9iZY1UJgi0SXP87lwsL_B8iUS1EY_saIl5EzfUV-Wb1dIQLF3LfIrVRTET8uok2Daxle3qEm5BOO3I1e-XgqEptkpu1L8Q204CwrewJ9th711FF5GXaZLSfy1j7PfS
      
 
## Request Access Token
1. If the user accepted your request, then your app is ready to exchange the authorization code for an access token. It can do this by sending a POST request to the https://accounts.spotify.com/api/token endpoint.
2. The body of this POST request must contain the following parameters encoded in application/x-www-form-urlencoded:

    **`grant_type`**	    This field must contain the value "**`authorization_code`**".
   
    **`code`**		        The authorization code returned from the previous request.
    
    **`redirect_uri`**	    This parameter is used for validation only (there is no actual redirection). The value of this parameter must exactly match the value of redirect_uri supplied when requesting the authorization code.
3. The request must include the following HTTP headers:
    
    **`Authorization`**	Base 64 encoded string that contains the client ID and client secret key. The field must have the format: Authorization: **`Basic <base64 encoded client_id:client_secret>`**.You can generate it from Postman by selecting Type = Basic Auth and providing Client ID/Secret in Username/Password fields under Authorization.
    
    **`Content-Type`**	Set to **`application/x-www-form-urlencoded`**.
    
4. On success, the response will have a 200 OK status and the following JSON data in the response body:

    **`access_token`**	An access token that can be provided in subsequent calls, for example to Spotify Web API services.
    
    **`token_type`**	How the access token may be used: always "Bearer".
    
    **`scope`**	    	A space-separated list of scopes which have been granted for this access_token
    
    **`expires_in`**	The time period (in seconds) for which the access token is valid.
    
    **`refresh_token`**	When access token expires, it can be used to re-authenticate the user.	
    
5. Access Token from above can be used to access the resources on Spotify based on the allowed scopes.
   One sample request below to search for any track on Spotify. 
   
## Accessing Spotify Resources
Include the **`Access Token`** from above to **`Authorization`** header as a **`Bearer`** token for every request to Spotify Web Apis.

Refer [here](https://developer.spotify.com/documentation/web-api) for additional details and to access all the resources exposed by Spotify Developer platform.

Import the _`collection`_ to POSTMAN to play around some apis related to playlist on Spotify.


       